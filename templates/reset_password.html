<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Reset Password</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/reset_password.css') }}">
</head>
<body>

<input class="c-checkbox" type="checkbox" id="start">
<input class="c-checkbox" type="checkbox" id="progress2">
<input class="c-checkbox" type="checkbox" id="finish">

<div class="c-form__progress"></div>

<div class="c-formContainer">
  <form class="c-form" id="resetForm">
    <!-- Étape 1: Username -->
    <div class="c-form__group">
      <label class="c-form__label" for="username">
        <input type="text" id="username" name="username" class="c-form__input" placeholder=" " required>
        <label class="c-form__next" for="progress2" role="button" id="verifyUsernameBtn">
          <span class="c-form__nextIcon"></span>
        </label>
        <span class="c-form__groupLabel">Enter your username</span>
        <b class="c-form__border"></b>
      </label>
    </div>

    <!-- Étape 2: New Password -->
    <div class="c-form__group">
      <label class="c-form__label" for="new_password">
        <input type="password" id="new_password" name="new_password" class="c-form__input" placeholder=" " required>
        <label class="c-form__next" for="finish" role="button" id="updatePasswordBtn">
          <span class="c-form__nextIcon"></span>
        </label>
        <span class="c-form__groupLabel">Enter your new password</span>
        <b class="c-form__border"></b>
      </label>
    </div>

    <label class="c-form__toggle" for="start">Reset Password<span class="c-form__toggleIcon"></span></label>
  </form>
</div>

<script>
document.getElementById('verifyUsernameBtn').addEventListener('click', function(e) {
  e.preventDefault();
  const username = document.getElementById('username').value;
  fetch('/verify-username', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'username=' + encodeURIComponent(username)
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'ok') {
      document.getElementById('progress2').checked = true;
    } else {
      alert('Username not found!');
    }
  });
});

document.getElementById('updatePasswordBtn').addEventListener('click', function(e) {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const newPassword = document.getElementById('new_password').value;
  fetch('/update-password', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'username=' + encodeURIComponent(username) + '&new_password=' + encodeURIComponent(newPassword)
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      document.getElementById('finish').checked = true;
    } else {
      alert('Error updating password!');
    }
  });
});
</script>

</body>
</html>
